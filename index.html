<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Редактор M3U8 на GitHub Pages</title>
<style>
body { font-family: Arial, sans-serif; background: #f4f4f4; padding: 20px; }
h1 { text-align: center; }
#editor { width: 100%; max-width: 600px; margin: auto; }
ul { list-style: none; padding: 0; }
li { background: #fff; margin: 5px 0; padding: 10px; display: flex; justify-content: space-between; align-items: center; border-radius: 5px; }
button { margin-left: 5px; }
input[type="text"] { width: 70%; padding: 5px; }
textarea { width: 100%; height: 150px; margin-top: 20px; padding: 10px; }
</style>
</head>
<body>

<h1>Редактор M3U8 (GitHub Pages)</h1>
<div id="editor">
    <input type="text" id="newUrl" placeholder="Введите URL .m3u8">
    <button onclick="addUrl()">Добавить</button>
    <button onclick="downloadM3U8()">Скачать .m3u8</button>
    <ul id="playlist"></ul>
    <textarea id="m3u8Output" readonly></textarea>
</div>

<script>
let playlist = [];

// Загружаем из localStorage, если есть
if(localStorage.getItem('liveM3U8')) {
    playlist = JSON.parse(localStorage.getItem('liveM3U8'));
}

function renderPlaylist() {
    const ul = document.getElementById('playlist');
    ul.innerHTML = '';
    playlist.forEach((url, index) => {
        const li = document.createElement('li');
        li.innerHTML = `<span>${url}</span>
                        <div>
                            <button onclick="editUrl(${index})">Редактировать</button>
                            <button onclick="deleteUrl(${index})">Удалить</button>
                        </div>`;
        ul.appendChild(li);
    });
    updateOutput();
    saveToLocal();
}

function addUrl() {
    const input = document.getElementById('newUrl');
    const url = input.value.trim();
    if(url) {
        playlist.push(url);
        input.value = '';
        renderPlaylist();
    }
}

function editUrl(index) {
    const newUrl = prompt("Редактировать URL:", playlist[index]);
    if(newUrl !== null && newUrl.trim() !== '') {
        playlist[index] = newUrl.trim();
        renderPlaylist();
    }
}

function deleteUrl(index) {
    playlist.splice(index, 1);
    renderPlaylist();
}

function updateOutput() {
    const output = document.getElementById('m3u8Output');
    let content = '#EXTM3U\n';
    playlist.forEach(url => content += url + '\n');
    output.value = content;
}

// Сохраняем в localStorage
function saveToLocal() {
    localStorage.setItem('liveM3U8', JSON.stringify(playlist));
}

// Скачать как live.m3u8
function downloadM3U8() {
    const blob = new Blob([document.getElementById('m3u8Output').value], {type: 'application/vnd.apple.mpegurl'});
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = 'live.m3u8';
    a.click();
    URL.revokeObjectURL(a.href);
}

renderPlaylist();
</script>

</body>
</html>
